"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5603],{3905:(e,r,n)=>{n.d(r,{Zo:()=>m,kt:()=>g});var t=n(7294);function s(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function a(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function i(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){s(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function l(e,r){if(null==e)return{};var n,t,s=function(e,r){if(null==e)return{};var n,t,s={},a=Object.keys(e);for(t=0;t<a.length;t++)n=a[t],r.indexOf(n)>=0||(s[n]=e[n]);return s}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)n=a[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var o=t.createContext({}),u=function(e){var r=t.useContext(o),n=r;return e&&(n="function"==typeof e?e(r):i(i({},r),e)),n},m=function(e){var r=u(e.components);return t.createElement(o.Provider,{value:r},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},c=t.forwardRef((function(e,r){var n=e.components,s=e.mdxType,a=e.originalType,o=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),d=u(n),c=s,g=d["".concat(o,".").concat(c)]||d[c]||p[c]||a;return n?t.createElement(g,i(i({ref:r},m),{},{components:n})):t.createElement(g,i({ref:r},m))}));function g(e,r){var n=arguments,s=r&&r.mdxType;if("string"==typeof e||s){var a=n.length,i=new Array(a);i[0]=c;var l={};for(var o in r)hasOwnProperty.call(r,o)&&(l[o]=r[o]);l.originalType=e,l[d]="string"==typeof e?e:s,i[1]=l;for(var u=2;u<a;u++)i[u]=n[u];return t.createElement.apply(null,i)}return t.createElement.apply(null,n)}c.displayName="MDXCreateElement"},2615:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>l,toc:()=>u});var t=n(7462),s=(n(7294),n(3905));const a={title:"Nov 04"},i=void 0,l={unversionedId:"learning-journal/2023/November/11_4_23",id:"learning-journal/2023/November/11_4_23",title:"Nov 04",description:"What I did today:",source:"@site/docs/learning-journal/2023/November/11_4_23.md",sourceDirName:"learning-journal/2023/November",slug:"/learning-journal/2023/November/11_4_23",permalink:"/my-website/docs/learning-journal/2023/November/11_4_23",draft:!1,tags:[],version:"current",frontMatter:{title:"Nov 04"},sidebar:"tutorialSidebar",previous:{title:"Nov 11",permalink:"/my-website/docs/learning-journal/2023/November/11_11_23"},next:{title:"Nov 05",permalink:"/my-website/docs/learning-journal/2023/November/11_5_23"}},o={},u=[{value:"What I did today:",id:"what-i-did-today",level:2},{value:"Setting up the project",id:"setting-up-the-project",level:3},{value:"Working in on the Restaurant Application",id:"working-in-on-the-restaurant-application",level:3},{value:"Working on the Restaurant API",id:"working-on-the-restaurant-api",level:3}],m={toc:u},d="wrapper";function p(e){let{components:r,...n}=e;return(0,s.kt)(d,(0,t.Z)({},m,n,{components:r,mdxType:"MDXLayout"}),(0,s.kt)("h2",{id:"what-i-did-today"},"What I did today:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Review and updated Little Lemon Restaurant Project"),(0,s.kt)("li",{parentName:"ul"},"Updated old journal entries on my website")),(0,s.kt)("h1",{id:"little-lemon-restaurant-review-and-updated"},"Little Lemon Restaurant review and updated"),(0,s.kt)("h3",{id:"setting-up-the-project"},"Setting up the project"),(0,s.kt)("p",null,"Install Django"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-commandine"},"pip install django\n")),(0,s.kt)("p",null,"Create littlemon project"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-commandline"},"django-admin startproject littlelemon .\n")),(0,s.kt)("p",null,"Create restaurant app"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-commandline"},"python3 manage.py startapp restaurant\n")),(0,s.kt)("p",null,"Create restaurant API"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-commandline"},"python3 manage.py startapp restaurant_api\n")),(0,s.kt)("p",null,"Connect restaurant app and restaurant API to the project"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="littlemon/settings.py"',title:'"littlemon/settings.py"'},"\nINSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n    'restaurant.apps.RestaurantConfig',  # connect restaurant app\n    'restaurant_api.apps.RestaurantApiConfig',  # connect restaurant api\n    'rest_framework',  # install Django REST framework\n    'djoser',  # install djoser\n]\n")),(0,s.kt)("p",null,"Connect restaurant app and restaurant API's URLS to the project"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python",metastring:'title = "littlelemon/urls.py"',title:!0,"":"",'"littlelemon/urls.py"':!0},"\nfrom django.contrib import admin\nfrom django.urls import path, include\n\nurlpatterns = [\n    path('admin/', admin.site.urls),\n    path('', include('restaurant.urls')),\n    path('api/', include('restaurant_api.urls')),\n    path('auth/', include('djoser.urls')),\n    path('auth/', include('djoser.urls.authtoken')),\n]\n\n")),(0,s.kt)("h3",{id:"working-in-on-the-restaurant-application"},"Working in on the Restaurant Application"),(0,s.kt)("p",null,"Setting up the models"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="restaurant/models.py"',title:'"restaurant/models.py"'},'from django.db import models\n\n\n# Create your models here.\nclass Booking(models.Model):\n    first_name = models.CharField(max_length=200)\n    last_name = models.CharField(max_length=200)\n    guest_number = models.IntegerField()\n    comment = models.CharField(max_length=1000)\n\n    def __str__(self):\n        return self.first_name + " " + self.last_name\n\n\nclass Menu(models.Model):\n    name = models.CharField(max_length=200)\n    price = models.IntegerField()\n    description = models.TextField(blank=True, null=True)\n\n    def __str__(self):\n        return self.name\n\n')),(0,s.kt)("p",null,"Register these models to admin site"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="restaurant/admin.py"',title:'"restaurant/admin.py"'},"from django.contrib import admin\nfrom .models import Booking, Menu\n\n\n# Register your models here.\nadmin.site.register(Booking)\nadmin.site.register(Menu)\n\n")),(0,s.kt)("p",null,"Write views for the application"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="restaurant/views.py"',title:'"restaurant/views.py"'},'from django.shortcuts import render\nfrom .forms import BookingForm\nfrom .models import Menu\n\n\n# Create your views here.\ndef home(request):\n    return render(request, "index.html")\n\n\ndef about(request):\n    return render(request, "about.html")\n\n\ndef book(request):\n    form = BookingForm()\n    if request.method == "POST":\n        form = BookingForm(request.POST)\n        if form.is_valid():\n            form.save()\n    context = {"form": form}\n    return render(request, "book.html", context)\n\n\ndef menu(request):\n    menu_data = Menu.objects.all()\n    main_data = {"menu_data": menu_data}\n    return render(request, "menu.html", main_data)\n\n\ndef display_menu_item(request, pk=None):\n    if pk:\n        menu_item = Menu.objects.get(pk=pk)\n    else:\n        menu_item = ""\n    return render(request, "menu_item.html", {"menu_item": menu_item})\n\n')),(0,s.kt)("p",null,"Connect the views to the urls"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="restaurant/urls.py"',title:'"restaurant/urls.py"'},"from django.urls import path\nfrom . import views\n\n\nurlpatterns = [\n    path('', views.home, name=\"home\"),\n    path('about/', views.about, name=\"about\"),\n    path('book/', views.book, name=\"book\"),\n    path('menu/', views.menu, name=\"menu\"),\n    path('menu/<int:pk>/', views.display_menu_item, name=\"menu_item\")\n]\n")),(0,s.kt)("h3",{id:"working-on-the-restaurant-api"},"Working on the Restaurant API"),(0,s.kt)("p",null,"Set up models"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="restaurant_api/models.py"',title:'"restaurant_api/models.py"'},"from django.db import models\nfrom django.contrib.auth.models import User\n\n\n# Create your models here.\nclass Category(models.Model):\n    slug = models.SlugField()\n    title = models.CharField(max_length=255, db_index=True)\n\n\nclass MenuItem(models.Model):\n    title = models.CharField(max_length=255, db_index=True)\n    price = models.DecimalField(max_digits=6, decimal_places=2, db_index=True)\n    featured = models.BooleanField(db_index=True)\n    category = models.ForeignKey(Category, on_delete=models.PROTECT)\n\n\nclass Cart(models.Model):\n    user = models.ForeignKey(User, on_delete=models.CASCADE)\n    menuitem = models.ForeignKey(MenuItem, on_delete=models.CASCADE)\n    quantity = models.SmallIntegerField()\n    unit_price = models.DecimalField(max_digits=6, decimal_places=2)\n    price = models.DecimalField(max_digits=6, decimal_places=2)\n\n    class Meta:\n        unique_together = ('menuitem', 'user')\n\n\nclass Order(models.Model):\n    user = models.ForeignKey(User, on_delete=models.CASCADE)\n    delivery_crew = models.ForeignKey(User, on_delete=models.SET_NULL, related_name=\"delivery_crew\", null=True)\n    status = models.BooleanField(default=0, db_index=True)\n    total = models.DecimalField(max_digits=6, decimal_places=2, default=0)\n    date = models.DateField(db_index=True)\n\n\nclass OrderItem(models.Model):\n    order = models.ForeignKey(Order, on_delete=models.CASCADE, related_name=\"order\")\n    menuitem = models.ForeignKey(MenuItem, on_delete=models.CASCADE)\n    quantity = models.SmallIntegerField()\n    price = models.DecimalField(max_digits=6, decimal_places=2)\n\n    class Meta:\n        unique_together = ('order', 'menuitem')\n\n\n")),(0,s.kt)("p",null,"Set up serializers"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="restaurant_api/serializers.py',title:'"restaurant_api/serializers.py'},"from .models import Category, MenuItem, Cart, Order, OrderItem\nfrom django.contrib.auth.models import User\nfrom rest_framework import serializers\n\n\nclass CategorySerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Category\n        fields = ['id', 'title', 'slug']\n\n\nclass MenuItemSerializer(serializers.ModelSerializer):\n    category = serializers.PrimaryKeyRelatedField(\n        queryset=Category.objects.all()\n    )\n\n    class Meta:\n        model = MenuItem\n        fields = ['id', 'tile', 'price', 'category', 'featured']\n\n\nclass CartSerializer(serializers.ModelSerializer):\n    user = serializers.PrimaryKeyRelatedField(\n        queryset=User.objects.all(),\n        default=serializers.CurrentUserDefault()\n    )\n\n    def validate(self, attrs):\n        attrs['price'] = attrs['quantity'] * attrs['unit_price']\n        return attrs\n\n    class Meta:\n        model = Cart\n        fields = ['user', 'menuitem', 'unit_price', 'quantity', 'price']\n        extra_kwargs = {\n            'price': {'read_only': True}\n        }\n\n\nclass OrderItemSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = OrderItem\n        fields = ['order', 'menuitem', 'quantity', 'price']\n\n\nclass OrderSerializer(serializers.ModelSerializer):\n    orderitem = OrderItemSerializer(many=True, read_only=True, source='order')\n\n    class Meta:\n        model = Order\n        fields = ['id', 'user', 'deliver_crew', 'status', 'date', 'total', 'orderitem']\n\n\nclass UserSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = User\n        fields = ['id', 'username', 'email']\n")),(0,s.kt)("p",null,"Write views for API"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="restaurant_api/views.py"',title:'"restaurant_api/views.py"'},'\nfrom rest_framework.permissions import IsAdminUser, IsAuthenticated\nfrom rest_framework import generics\nfrom rest_framework import viewsets, status\nfrom django.shortcuts import get_object_or_404\nfrom django.contrib.auth.models import Group, User\nfrom rest_framework.response import Response\nfrom .models import *\nfrom .serializers import *\n\n\n# Create your views here.\nclass CategoriesView(generics.ListCreateAPIView):\n    queryset = Category.objects.all()\n    serializer_class = CategorySerializer\n\n    def get_permissions(self):\n        permission_classes = []\n        if self.request.method != "GET":\n            permission_classes = [IsAuthenticated]\n\n        return [permission() for permission in permission_classes]\n\n\nclass MenuItemView(generics.ListCreateAPIView):\n    queryset = MenuItem.objects.all()\n    serializer_class = MenuItemSerializer\n    search_fields = [\'category__title\']\n    ordering_fields = [\'price\', \'inventory\']\n\n    def get_permissions(self):\n        permission_classes = []\n        if self.request.method != "GET":\n            permission_classes = [IsAuthenticated]\n\n        return [permission() for permission in permission_classes]\n\n\nclass SingleMenuItemView(generics.RetrieveUpdateDestroyAPIView):\n    queryset = MenuItem.objects.all()\n    serializer_class = MenuItemSerializer\n\n    def get_permissions(self):\n        permission_classes = []\n        if self.request.method != "GET":\n            permission_classes = [IsAuthenticated]\n\n        return [permission() for permission in permission_classes]\n\n\nclass CartView(generics.ListCreateAPIView):\n    queryset = Cart.objects.all()\n    serializer_class = CartSerializer\n\n    def get_queryset(self):\n        return Cart.objects.all().filter(user=self.request.user)\n\n    def delete(self, request, *args, **kwargs):\n        Cart.objects.all().filter(user=self.request.user).delete()\n        return Response("ok")\n\n\nclass OrderView(generics.ListCreateAPIView):\n    queryset = Order\n    serializer_class = OrderSerializer\n\n    def get_queryset(self):\n        if self.request.user.is_superuser:\n            return Order.objects.all()\n        elif self.request.user.groups.count() == 0:  # normal customer - no group\n            return Order.objects.all().filter(user=self.request.user)\n        elif self.request.user.groups.filter(name="Delivery Crew").exists():  # delivery crew\n            return Order.objects.all().filter(delivery_crew=self.request.user)  # only show orders assigned to delivery crew\n        else:  # delivery crew or manager\n            return Order.objects.all()\n\n    def create(self, request, *args, **kwargs):\n        menuitem_count = Cart.objects.all().filter(user=self.request.user).count()\n        if menuitem_count == 0:\n            return Response({"message": "no item in cart"})\n\n        data = request.data.copy()\n        total = self.get_total_price(self.request.user)\n        data[\'total\'] = total\n        data[\'user\'] = self.request.user.id\n        order_serializer = OrderSerializer(data=data)\n        if order_serializer.is_valid():\n            order = order_serializer.save()\n\n            items = Cart.objects.all().filter(user=self.request.user).all()\n\n            for item in items.values():\n                orderitem = OrderItem(\n                    order=order,\n                    menuitem=item[\'menuitem_id\'],\n                    price=item[\'price\'],\n                    quantity=item[\'quantity\'],\n                )\n                orderitem.save()\n\n            Cart.objects.all().filter(user=self.request.user).delete()  # delete cart items\n\n            result = order_serializer.data.copy()\n            result[\'total\'] = total\n            return Response(order_serializer.data)\n\n    def get_total_price(self, user):\n        total = 0\n        items = Cart.objects.all().filter(user=user).all()\n        for item in items.values():\n            total += item[\'price\']\n        return total\n\n\nclass SingleOrderView(generics.RetrieveUpdateAPIView):\n    queryset = Order.objects.all()\n    serializer_class = OrderSerializer\n    permission_classes = [IsAuthenticated]\n\n    def update(self, request, *args, **kwargs):\n        if self.request.user.groups.count() == 0:  # Normal user, not belonging to any group = Customer\n            return Response(\'Not Ok\')\n        else:  # everyone else - Super Admin, Manager and Delivery Crew\n            return super().update(request, *args, **kwargs)\n\n\nclass GroupViewSet(viewsets.ViewSet):\n    permission_classes = [IsAdminUser]\n\n    def list(self, request):\n        users = User.objects.all().filter(groups__name=\'Manager\')\n        items = UserSerializer(users, many=True)\n        return Response(items.data)\n\n    def create(self, request):\n        user = get_object_or_404(User, username=request.data[\'username\'])\n        managers = Group.objects.get(name="Manager")\n        managers.user_set.add(user)\n        return Response({"message": "user added to the manager group"}, 200)\n\n    def destroy(self, request):\n        user = get_object_or_404(User, username=request.data[\'username\'])\n        managers = Group.objects.get(name="Manager")\n        managers.user_set.remove(user)\n        return Response({"message": "user removed from the manager group"}, 200)\n\n\nclass DeliveryCrewViewSet(viewsets.ViewSet):\n    permission_classes = [IsAuthenticated]\n\n    def list(self, request):\n        users = User.objects.all().filter(groups__name=\'Delivery Crew\')\n        items = UserSerializer(users, many=True)\n        return Response(items.data)\n\n    def create(self, request):\n        # only for super admin and managers\n        if not self.request.user.is_superuser:\n            if not self.request.user.groups.filter(name=\'Manager\').exists():\n                return Response({"message": "forbidden"}, status.HTTP_403_FORBIDDEN)\n\n        user = get_object_or_404(User, username=request.data[\'username\'])\n        dc = Group.objects.get(name="Delivery Crew")\n        dc.user_set.add(user)\n        return Response({"message": "user added to the delivery crew group"}, 200)\n\n    def destroy(self, request):\n        # only for super admin and managers\n        if not self.request.user.is_superuser:\n            if not self.request.user.groups.filter(name=\'Manager\').exists():\n                return Response({"message": "forbidden"}, status.HTTP_403_FORBIDDEN)\n        user = get_object_or_404(User, username=request.data[\'username\'])\n        dc = Group.objects.get(name="Delivery Crew")\n        dc.user_set.remove(user)\n        return Response({"message": "user removed from the delivery crew group"}, 200)\n')),(0,s.kt)("p",null,"Connect URLS to the views"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="restaurant_api/urls.py"',title:'"restaurant_api/urls.py"'},"\nfrom django.urls import path\nfrom . import views\n\nurlpatterns = [\n    path('categories', views.CategoriesView.as_view()),\n    path('menu-items', views.MenuItemView.as_view()),\n    path('menu-items/<int:pk>', views.SingleMenuItemView.as_view()),\n    path('cart/menu-items', views.CartView.as_view()),\n    path('orders', views.OrderView.as_view()),\n    path('orders/<int:pk>', views.SingleOrderView.as_view()),\n    path('groups/manager/users', views.GroupViewSet.as_view(\n        {'get': 'list', 'post': 'create', 'delete': 'destroy'})),\n    path('groups/delivery-crew/users', views.DeliveryCrewViewSet.as_view(\n        {'get': 'list', 'post': 'create', 'delete': 'destroy'}))\n]\n")))}p.isMDXComponent=!0}}]);